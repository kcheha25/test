def generate_density_map(image, points, sigma=15):
    """Génère une carte de densité en remplissant les objets."""
    h, w = image.shape[:2]
    density_map = np.zeros((h, w), dtype=np.float32)

    for obj in points:
        if len(obj) == 4:  # Chaque objet a 4 points (x1, y1), ..., (x4, y4)
            polygon = np.array(obj, np.int32).reshape((-1, 1, 2))
            cv2.fillPoly(density_map, [polygon], 1)  # Remplir l'objet entier

    # Appliquer un flou gaussien avec un noyau de taille impaire
    ksize = int(2 * np.ceil(sigma) + 1)  # Assurer que ksize est impair
    density_map = cv2.GaussianBlur(density_map, (ksize, ksize), sigma)
    
    # Normalisation
    density_map /= density_map.sum() if density_map.sum() > 0 else 1
    return density_map