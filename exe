pip install pyinstaller
pyinstaller --onefile app.py

pyinstaller --onefile --add-data "templates;templates" --add-data "static;static" app.py

import os, sys
from flask import Flask

# Trouver le bon chemin des fichiers (compatibilit√© PyInstaller)
if getattr(sys, 'frozen', False):  # Si lanc√© depuis l'ex√©cutable PyInstaller
    basedir = sys._MEIPASS
else:
    basedir = os.path.dirname(os.path.abspath(__file__))

app = Flask(__name__, 
            template_folder=os.path.join(basedir, "templates"),
            static_folder=os.path.join(basedir, "static"))

@app.route("/")
def home():
    return "Hello Flask inclus dans EXE !"

if __name__ == "__main__":
    app.run()


pyinstaller --onefile ^
  --add-data "templates;templates" ^
  --add-data "static;static" ^
  --add-data "models;models" ^
  app.py

import os, sys
from detectron2.engine import DefaultPredictor
from detectron2.config import get_cfg
import torch

# Chemin racine (normal ou compil√©)
if getattr(sys, 'frozen', False):
    basedir = sys._MEIPASS
else:
    basedir = os.path.dirname(os.path.abspath(__file__))

# Exemple Detectron2
cfg = get_cfg()
cfg.merge_from_file(os.path.join(basedir, "models", "config.yaml"))
cfg.MODEL.WEIGHTS = os.path.join(basedir, "models", "detectron2_model.pth")

predictor = DefaultPredictor(cfg)


import os
import webbrowser
from flask import Flask

BASEDIR = os.path.dirname(os.path.abspath(__file__))

app = Flask(
    __name__,
    template_folder=os.path.join(BASEDIR, "templates"),
    static_folder=os.path.join(BASEDIR, "static")
)

@app.route("/")
def home():
    return "Hello depuis l‚ÄôEXE avec Flask üöÄ"

if __name__ == "__main__":
    # Ouvrir automatiquement le navigateur
    port = 5000
    url = f"http://127.0.0.1:{port}/"
    webbrowser.open(url)  # ouvre dans le navigateur par d√©faut

    # Lancer le serveur Flask
    app.run(port=port)

pyinstaller --onefile --noconsole app.py


valeur_vv = None

with open("data.txt", "r", encoding="utf-8") as f:
    for ligne in f:
        if ligne.strip().startswith("Vv"):
            # R√©cup√©rer la partie apr√®s les deux-points
            valeur_vv = ligne.split(":", 1)[1].strip()
            # Remplacer la virgule par un point pour conversion
            valeur_vv = float(valeur_vv.replace(",", "."))
            break

print("Valeur Vv =", valeur_vv)

import os
import shutil
from flask import Flask, jsonify

app = Flask(__name__)

# Dossier source et cible
SOURCE_FOLDER = "xml_source"
TARGET_FOLDER = "xml_target"

# Chemins vers les ex√©cutables
EXE_MATRICE = r"C:\chemin\vers\programme1.exe"
EXE_AUTRE   = r"C:\chemin\vers\programme2.exe"

@app.route("/replace_xml", methods=["POST"])
def replace_xml():
    if not os.path.exists(SOURCE_FOLDER):
        return jsonify({"error": "Dossier source introuvable"}), 400
    if not os.path.exists(TARGET_FOLDER):
        os.makedirs(TARGET_FOLDER)

    replaced_files = []
    for filename in os.listdir(SOURCE_FOLDER):
        if filename.lower().endswith(".xml"):
            src_path = os.path.join(SOURCE_FOLDER, filename)
            dst_path = os.path.join(TARGET_FOLDER, filename)

            # Copier avec remplacement
            shutil.copy2(src_path, dst_path)
            replaced_files.append(filename)

            # V√©rifier le nom du fichier et lancer l'exe correspondant
            try:
                if filename.lower() == "matrice.xml":
                    os.startfile(EXE_MATRICE)
                else:
                    os.startfile(EXE_AUTRE)
            except Exception as e:
                return jsonify({
                    "error": f"Erreur lors du lancement de l'ex√©cutable pour {filename} : {str(e)}"
                }), 500

    if not replaced_files:
        return jsonify({"message": "Aucun fichier XML trouv√© dans le dossier source."})

    return jsonify({
        "message": f"{len(replaced_files)} fichier(s) XML remplac√©(s)",
        "files": replaced_files
    })


if __name__ == "__main__":
    app.run(debug=True)


pyinstaller --onefile --noconsole ^
  --hidden-import=imageio.plugins.ffmpeg ^
  --hidden-import=imageio.plugins.pillow ^
  --hidden-import=imageio.plugins.tifffile ^
  ton_script.py

hiddenimports=['imageio.plugins.pillow', 'imageio.plugins.ffmpeg', 'imageio.plugins.tifffile']

pyinstaller ton_script.spec


import subprocess

EXE_MATRICE = r"C:\chemin\vers\matrice.exe"
EXE_AUTRE   = r"C:\chemin\vers\autre.exe"

def lancer_exe_wait(path):
    # Utilise "start /wait" pour imiter os.startfile mais bloquer jusqu'√† la fin
    subprocess.run(["cmd", "/c", "start", "/wait", "", path], shell=True)

if filename.lower() == "matrice.xml":
    lancer_exe_wait(EXE_MATRICE)
else:
    lancer_exe_wait(EXE_AUTRE)

import os
import shutil
import time
from flask import Flask, jsonify

app = Flask(__name__)

SOURCE_FOLDER = "xml_source"
TARGET_FOLDER = "xml_target"
TEMP_FOLDER = "temp"  # Dossier o√π l'exe produit out.fda
EXE_MATRICE = r"C:\chemin\vers\exe_matrice.exe"
EXE_AUTRE = r"C:\chemin\vers\exe_autre.exe"

@app.route("/replace_xml", methods=["POST"])
def replace_xml():
    if not os.path.exists(SOURCE_FOLDER):
        return jsonify({"error": "Dossier source introuvable"}), 400
    if not os.path.exists(TARGET_FOLDER):
        os.makedirs(TARGET_FOLDER)
    if not os.path.exists(TEMP_FOLDER):
        os.makedirs(TEMP_FOLDER)

    replaced_files = []
    for filename in os.listdir(SOURCE_FOLDER):
        if filename.lower().endswith(".xml"):
            src_path = os.path.join(SOURCE_FOLDER, filename)
            dst_path = os.path.join(TARGET_FOLDER, filename)

            # Copier avec remplacement
            shutil.copy2(src_path, dst_path)
            replaced_files.append(filename)

            # Vider TEMP_FOLDER au d√©but de la boucle
            for temp_file in os.listdir(TEMP_FOLDER):
                temp_file_path = os.path.join(TEMP_FOLDER, temp_file)
                if os.path.isfile(temp_file_path):
                    os.remove(temp_file_path)

            # Lancer l'exe correspondant
            try:
                if filename.lower() == "matrice.xml":
                    os.startfile(EXE_MATRICE)
                else:
                    os.startfile(EXE_AUTRE)
            except Exception as e:
                return jsonify({
                    "error": f"Erreur lors du lancement de l'ex√©cutable pour {filename} : {str(e)}"
                }), 500

            # Attendre ind√©finiment que out.fda apparaisse dans TEMP_FOLDER
            out_path = os.path.join(TEMP_FOLDER, "out.fda")
            while not os.path.exists(out_path):
                time.sleep(0.5)

            # Copier out.fda vers TARGET_FOLDER avec le nom du XML
            new_out_name = os.path.splitext(filename)[0] + ".fda"
            new_out_path = os.path.join(TARGET_FOLDER, new_out_name)
            shutil.copy2(out_path, new_out_path)

            # Supprimer out.fda temporaire
            os.remove(out_path)

    if not replaced_files:
        return jsonify({"message": "Aucun fichier XML trouv√© dans le dossier source."})

    return jsonify({
        "message": f"{len(replaced_files)} fichier(s) XML remplac√©(s) et exe ex√©cut√©",
        "files": replaced_files
    })

import os
import shutil
import time
import xml.etree.ElementTree as ET
from flask import Flask, jsonify, request

app = Flask(__name__)

SOURCE_FOLDER = "xml_source"
TARGET_FOLDER = "xml_target"
TEMP_FOLDER = "temp"  # Dossier o√π l'exe produit out.fda
DATA_TXT = "data.txt"  # Fichier o√π lire Vv
EXE_MATRICE = r"C:\chemin\vers\exe_matrice.exe"

@app.route("/replace_xml", methods=["POST"])
def replace_xml():
    # üîπ R√©cup√©rer la valeur entr√©e par utilisateur (Vporo)
    vporo = request.form.get("Vporo", None)
    if vporo is None:
        return jsonify({"error": "Param√®tre Vporo manquant"}), 400

    try:
        vporo = float(vporo)
    except ValueError:
        return jsonify({"error": "Valeur Vporo invalide"}), 400

    # üîπ Lire la valeur Vv depuis data.txt
    valeur_vv = None
    with open(DATA_TXT, "r", encoding="utf-8") as f:
        for ligne in f:
            if ligne.strip().startswith("Vv"):
                valeur_vv = ligne.split(":", 1)[1].strip()
                valeur_vv = float(valeur_vv.replace(",", "."))
                break

    if valeur_vv is None:
        return jsonify({"error": "Impossible de trouver Vv dans data.txt"}), 500

    # üîπ Calcul de la diff√©rence
    delta = vporo - valeur_vv

    # üîπ V√©rifier si matrice.xml existe
    src_path = os.path.join(SOURCE_FOLDER, "matrice.xml")
    if not os.path.exists(src_path):
        return jsonify({"error": "matrice.xml introuvable dans le dossier source"}), 404

    if not os.path.exists(TARGET_FOLDER):
        os.makedirs(TARGET_FOLDER)
    if not os.path.exists(TEMP_FOLDER):
        os.makedirs(TEMP_FOLDER)

    dst_path = os.path.join(TARGET_FOLDER, "matrice.xml")

    try:
        # üîπ Charger et modifier AggINVv dans matrice.xml
        tree = ET.parse(src_path)
        root = tree.getroot()

        node = root.find(".//AggINVv")
        if node is not None and node.text:
            valeur_actuelle = float(node.text.replace(",", "."))
            nouvelle_valeur = valeur_actuelle + delta
            node.text = str(nouvelle_valeur)
            tree.write(dst_path, encoding="utf-8", xml_declaration=True)
        else:
            # Si pas trouv√©, copier simplement
            shutil.copy2(src_path, dst_path)
    except Exception as e:
        return jsonify({"error": f"Erreur modification XML : {e}"}), 500

    # üîπ Nettoyer TEMP_FOLDER
    for temp_file in os.listdir(TEMP_FOLDER):
        temp_file_path = os.path.join(TEMP_FOLDER, temp_file)
        if os.path.isfile(temp_file_path):
            os.remove(temp_file_path)

    # üîπ Lancer l'ex√©cutable
    try:
        os.startfile(EXE_MATRICE)
    except Exception as e:
        return jsonify({"error": f"Erreur lancement exe : {e}"}), 500

    # üîπ Attendre que out.fda apparaisse
    out_path = os.path.join(TEMP_FOLDER, "out.fda")
    while not os.path.exists(out_path):
        time.sleep(0.5)

    # üîπ Copier out.fda vers TARGET_FOLDER en le renommant
    new_out_path = os.path.join(TARGET_FOLDER, "matrice.fda")
    shutil.copy2(out_path, new_out_path)
    os.remove(out_path)

    return jsonify({
        "message": f"matrice.xml trait√©, AggINVv ajust√© (delta={delta:.4f}) et exe ex√©cut√©",
        "new_fda": new_out_path
    })


if __name__ == "__main__":
    app.run(debug=True)
